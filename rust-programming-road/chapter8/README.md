# 字符串和集合类型

数据结构是计算机存储和组织数据的方式。对于不同的场景，精心选择的数据结构可以带来更高的运行效率或存储效率。通常，通过确定数据结构体来选择相应的算法，也可以通过算法来选择数据结构，不管是哪种情况，选择合适的数据结构相当重要。

程序中最常用的三大数据结构是字符串、数组和映射。字符串是特殊的线性表，是由零个或多个字符组成的有限序列。但是字符和数组、映射的区别在于，字符串是被作为一个整体来关注和使用的，而数组和映射关注最多的是其中元素及他们之间的关系，所以，数组和映射也被称为集合类型。

Rust作为一门现代高级语言，也自然为这三大数据结构提供了丰富的操作支持。

## 8.1 字符串

### 8.1.1 字符编码

国际标准化组织制定了通过的多字节编码字符集，业绩素食Unicode字符集。Unicode字符集相当于一张表，其中包含了世界上所有语言中可能出现的字符，每个字符对应了一个非负整数，该数字称为码点(code Point). 这些码点也分为不同的类型，包括标量值(Scala Value), 代理对码点，非字符码点，保留码点和私有码点。其中标量值最常用，他是指实际存在对应字符的码位，其范围时0x0000~0xD7FF和0xE000~0x10FFF两段。Unicode字符集只规定了字符所对应的码点，却没有指定如何存储。如果直接存储码位，则太耗费空间了，因为Unicode字符集的每个字符都占4字节，传输效率非常低，虽然Unicode字符集解决了字符串通用的问题，但是必须寻求另一种存储方式，在保证Unicode字符集通用的情况下，更加节约流量和硬盘空间，这种存储方式就是码元(Code Unit)组成的序列。

码元是指用于存储和交换编码文本的最小比特组合。比如计算机处理字符的最小单位1字节就是一个码元，通过将Unicode标量值和码元序列建立一一映射关系，就构成了编码表。在Unicode中一共
有三种这样的字符编码表: UTF-8, UTF-16, UTF-32，他们正好对应了1字节、2字节、4字节的码元。对于UTF-16和UTF-32来说，因为他们的码元分别是2字节和4字节，所以就得考虑字节序问题，而对于UTF-8来说，一个码元只有1字节，所以不存在字节序问题，可以直接存储。

UTF-8编码规则：
- 当一个字符在ASCII码的范围(兼容ASCII码)内时，就用1字节表示，因为ASCII码中的字符最多使用7个比特位，所以前面需要补0.
- 当一个字符占用了n字节时，第一个字节的前n位设置为1，第n+1位设置为0，后面的字节的前两位设置为10

想这种将Unicode码位转换为字节序列的过程，叫做**编码**，反过来将编码字节序列转换为字符集中码位的过程，就叫做**解码**。

UTF-8编码的好处就是在实际传输过程中其占据的长度不是固定的，在保证Unicode通用性的情况下避免了流量和空间的浪费，而且还保持了在传输过程中不会错判字符。想一想，如果只是按Unicode码位存储，在则传输过程中是按固定的字节长度来识别字符的，如果在传输过程中出现问题，就会发生错判字符的问题。正是因为这些优点，UTF-8才能被广泛应用于互联网中。

