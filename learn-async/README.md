# Rust 线程安全

Rust不经在没有自动垃圾回收的条件下实现了内存安全，而且实现了线程安全。Rust编译器可以在编译阶段避免所有的数据竞争问题。

## 什么是线程

线程是操作系统能够进行调度的最小单位，他是进程中的实际运作单位，每个进程至少包含一个线程。

多线程的优势：

- 容量利用多核优势
- 比单线程反应更敏捷，比多线程资源共享更容易。

线程的调度是不受我们控制的，即便线程1和线程2内部的执行流程不变，只要调度时机发生了变化，结果也会不同。

## 启动线程

Rust标准库中与线程相关的内容在std::thread模块中，Rust中的线程是对操作系统线程的直接封装。

创建线程的方法：

```rust
use std::thread;
thread::spawn(move || {
	// logic
});
```

默认情况下，新创建的子线程与原来父线程的分离的关系。也就说，子线程可以在父线程结束后继续存在。除非父线程是主线程。

这是因为，如果一个进程的主线程也退出了，这个进程就会终止。其他所有的线程也会随之结束。

如果我们需要等待子线程执行结束，那么可以使用join方法：

```rust
use std::thread;

// child type is JoinHandle<T>, 
let child  = thread::spawn( move || {
	// logic
});

// parent thread wait chile thread end 
let res = child.join();
```

