# å®æˆ˜Rust

## Rust è¯­è¨€å­¦ä¹ è§‚

### å­¦ä¹ Rustçš„åæ¡æœ€ä½³å»ºè®®

- ä»æ•´ä½“å‡ºå‘ï¼Œä¸è¦è®©è‡ªå·±é™·å…¥åˆ°ç»†èŠ‚ä¸­å»
  - Rustè¯­è¨€æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ
  - Rustè®¾è®¡å“²å­¦æ˜¯ä»€ä¹ˆï¼Ÿ
  - Rustç¤¾åŒºå’Œç”Ÿæ€å¦‚ä½•ï¼Ÿ
- æŠ›å¼ƒä¸€æ¬¡æ€§å­¦ä¼šçš„å¿µå¤´ï¼Œåˆ†å±‚æ¬¡é€’è¿›å¼å­¦ä¹ 
  - å†…å­˜ç®¡ç†
  - ç±»å‹ç³»ç»Ÿ
  - æ‰€æœ‰æƒç³»ç»Ÿ
  - ç¼–ç¨‹èŒƒå¼
- å’Œä½ å·²çŸ¥çš„çŸ¥è¯†å»ºç«‹è”ç³»
- å­¦ä¼šé˜…è¯»æºç ï¼Œä»æºç ä¸­å­¦ä¹ 
- é€šè¿‡ä¸»é¢˜å¼é˜…è¯»å¡«è¡¥çŸ¥è¯†ç©ºç™½
- æ—¶åˆ»æŠŠæ¡Rustè®¾è®¡å“²å­¦
- æœ‰æ„è¯†åœ°æ„å»ºRustè¯­è¨€çš„å¿ƒæ™ºæ¨¡å‹
- å¤šåˆ†äº«å¤šæé—®å¤šäº¤æµ
- ä¸ºå¼€æºé¡¹ç›®åšè´¡çŒ®ï¼Œé”»ç‚¼è‡ªå·±
- é˜…è¯» ã€ŠRustç¼–ç¨‹ä¹‹é“ã€‹

## Rustè¯­è¨€æ¦‚è§ˆ

ææ¸…æ¥šä¸‰ä¸ªé—®é¢˜ï¼š

- Rustä»å“ªé‡Œæ¥ï¼Ÿ
- Rustæ˜¯ä»€ä¹ˆï¼Ÿ
- Rustè¦åˆ°å“ªé‡Œå»ï¼Ÿ



### Rust ä»å“ªé‡Œæ¥ï¼Ÿ

ä¸€é—¨è¯­è¨€çš„è¯ç”Ÿï¼Œæ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚

2006å¹´ï¼ŒèŒä¸šç¼–ç¨‹è¯­è¨€å·¥ç¨‹å¸ˆï¼ŒGraydon Hoare 

Graydoneå¯¹Rustè¯­è¨€çš„æœŸæœ›æ˜¯ï¼š

- å¿…é¡»å®‰å…¨ï¼Œä¸æ˜“å´©æºƒ
- ä¸éœ€è¦å¼•å…¥GCï¼Œæ³¨é‡æ€§èƒ½
- åº”è¯¥æ‹¥æœ‰å¹¿æ³›çš„ç‰¹æ€§ï¼Œè®©ç¨‹åºå‘˜å†™å‡ºæ˜“äºç»´æŠ¤ï¼Œè°ƒè¯•ï¼Œä¸”æ›´å®‰å…¨æ›´é«˜æ•ˆçš„ä»£ç ã€‚

Rust Logo æ‰¿è½½äº†åˆ›é€ è€…å¯¹Rustè¯­è¨€çš„é¢„æœŸ

2020å¹´5æœˆ15æ—¥ Rustç¨³å®šç‰ˆå‘å¸ƒ 5å‘¨å¹´

- å†…å­˜å®‰å…¨ä¸ºç¬¬ä¸€å‡†åˆ™
- æ³¨é‡å¹¶å‘å®‰å…¨ï¼Œé¿å…æ•°æ®ç«äº‰
- æŒç»­æå‡æ€§èƒ½
- ä¿æŒè¯­è¨€çš„é«˜åº¦ä¸€è‡´æ€§
- è¯­è¨€å¿…é¡»ç”±å¯è§çš„å®ç”¨æ€§
- æ³¨é‡å¼€å‘ä½“éªŒå’Œå­¦ä¹ ä½“éªŒ
- ç°ä»£åŒ–è¯­è¨€ç‰¹æ€§
- æ‹¥æŠ±å¼€æº

### Rustæ˜¯ä»€ä¹ˆ

Rustæ˜¯æ–°æ—¶ä»£çš„Cè¯­è¨€ 

ç†ç”±

- Rustè¯­è¨€æ˜¯ä¸€é—¨é€šç”¨å‹è¯­è¨€
- Rustè¯­è¨€çš„å†…å­˜å®‰å…¨æ–¹æ¡ˆé’ˆå¯¹çš„æ˜¯Cè¯­è¨€çš„ä¸è¶³
- å®‰å…¨ä¸”æ— ç¼æ²Ÿé€šCè¯­è¨€
- Rustæ˜¯å…·æœ‰æ··åˆèŒƒå¼çš„é¢å‘è¿‡ç¨‹å¼çš„ç¼–ç¨‹è¯­è¨€
- å’ŒCè¯­è¨€ç±»ä¼¼ï¼Œæ‹…è´Ÿäº†æ—¶ä»£çš„ä½¿å‘½

Rustè¯­è¨€æ˜¯ä¸€é—¨é€šç”¨å‹è¯­è¨€

- Rustè¯­è¨€é€‚åˆæ‰€æœ‰é¢†åŸŸç»å¤§éƒ¨åˆ†åœºæ™¯ï¼Œè£¸æœºï¼Œæ“ä½œç³»ç»Ÿï¼Œç½‘ç»œæœåŠ¡ï¼Œä¸Šå±‚åº”ç”¨ç­‰
- ä¸å…¶ä»–è¯­è¨€æ¨ªå‘æ¯”è¾ƒï¼ŒRustæ‹¥æœ‰ç°ä»£åŒ–è¯­è¨€ç‰¹æ€§ï¼Œåº”ç”¨èŒƒå›´è¦†ç›–åˆ°C/Cpp/Java/Go/JavaScriptç­‰é¢†åŸŸ

Rustè¯­è¨€çš„å†…å­˜å®‰å…¨æ–¹æ¡ˆé’ˆå¯¹çš„æ˜¯Cè¯­è¨€çš„ä¸è¶³

- ç¦æ­¢å¯¹ç©ºæŒ‡é’ˆå’Œæ‚¬å‚æŒ‡é’ˆè¿›è¡Œè§£å¼•ç”¨
- è¯»å–æœªåˆå§‹åŒ–çš„å†…å­˜
- ç¼“å†²åŒºæº¢å‡º
- éæ³•é‡Šæ”¾å·²ç»é‡Šæ”¾æˆ–æœªåˆ†é…çš„æŒ‡é’ˆ

å®‰å…¨ä¸”æ— ç¼æ²Ÿé€šCè¯­è¨€

- é€šè¿‡C-ABI é›¶æˆæœ¬å’ŒCè¯­è¨€æ‰“äº¤é“
- åˆ’åˆ†äº†Safe Rustå’ŒUnsafe Rust 

Rustæ˜¯å…·æœ‰æ··åˆèŒƒå¼çš„é¢å‘è¿‡ç¨‹å¼çš„ç¼–ç¨‹è¯­è¨€

- RuståŒ…å«äº†é¢å‘å¯¹è±¡ã€å‡½æ•°å¼å’Œæ³›å‹ä¸‰ç§ç¼–ç¨‹èŒƒå¼
- OOPå’ŒFPèŒƒå¼åœ¨Rustè¯­è¨€ä¸­ä½œä¸ºè¯­è¨€ç‰¹æ€§è€Œå­˜åœ¨ï¼Œå¹¶éæ˜¯æŠ½è±¡æ–¹å¼
- Rustè®©ä½ ä¸“æ³¨äºè§£å†³é—®é¢˜æœ¬èº«ï¼Œè€Œä¸å—ç¼–ç¨‹èŒƒå¼æ€æƒ³æ¡†æ¶çš„å¹²æ‰°

å’ŒCè¯­è¨€ç±»ä¼¼ï¼Œæ‹…è´Ÿäº†æ—¶ä»£çš„ä½¿å‘½

- æ“ä½œç³»ç»Ÿé­é‡å‘å±•ç“¶é¢ˆï¼ŒRustæ¥æ‹¯æ•‘
- Rustæ˜¯WASIæ¨å¹¿å’Œæ™®åŠçš„èƒŒåæ¨æ‰‹
- åŸºäºRustå®ç°çš„è¯­è¨€å¦‚é›¨åæ˜¥ç¬‹å‘ç”Ÿ

### Ruståˆ°å“ªé‡Œå»ï¼Ÿ

Rustå°†ä¸ºå„ä¸ªé¢†åŸŸçš„åŸºç¡€è®¾æ–½å»ºè®¾åšå‡ºè´¡çŒ®ï¼Œæœªæ¥ä¹Ÿè®¸åœ¨å¤šä¸ªé¢†åŸŸå‡ºç°æ€æ‰‹çº§åº”ç”¨



## è¯­æ³•é¢é¢è§‚

### è¯æ³•ç»“æ„

ä¸¤å¤§çŸ¥è¯†ç‚¹

- Rustè¯­è¨€ç‰ˆæœ¬è¯´æ˜
- Rustè¯æ³•ç»“æ„

#### Rustè¯­è¨€ç‰ˆæœ¬è¯´æ˜

- Rustè¯­è¨€çš„ç‰ˆæœ¬åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªç›¸äº’æ­£äº¤çš„æ¦‚å¿µï¼š
  - è¯­ä¹‰åŒ–ç‰ˆæœ¬(Sem Ver, Semantic Versioning)
  - å‘è¡Œç‰ˆæœ¬
  - Editionç‰ˆæ¬¡



##### è¯­ä¹‰åŒ–ç‰ˆæœ¬(Sem Ver, Semantic Versioning)

- å…¶æ ¼å¼ä¸ºï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ï¼Œ ä¾æ¬¡ç”¨å¥å·éš”å¼€
- ç®€å•è¯´ä¸€ä¸‹è¯­ä¹‰åŒ–ç‰ˆæœ¬å·é€’å¢è§„åˆ™ï¼š
  - ä¸»ç‰ˆæœ¬å·ï¼šå½“åšäº†ä¸å…¼å®¹çš„APIä¿®æ”¹
  - æ¬¡ç‰ˆæœ¬å·ï¼šå½“åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
  - ä¿®è®¢å·ï¼šå½“åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£



##### å‘è¡Œç‰ˆæœ¬

- Master -> Nightly
- beta -> Beta
- Stable -> Stable 



##### Edition ç‰ˆæ¬¡

- 2015 Edition
- 2018 Edition (1.31.*)
- 2021 Edition

#### è¯æ³•ç»“æ„

##### å†…å®¹ï¼š

- äº†è§£Rustç¼–è¯‘è¿‡ç¨‹
- å…­å¤§è¯æ³•ç»“æ„

##### Rustç¼–è¯‘è¿‡ç¨‹

- Rust Code(UTF-8) åˆ†è¯
- Tokens è§£æ
- AST é™çº§
- HIR é™çº§ ç‰ˆæ¬¡çš„æ¦‚å¿µåœ¨è¿™ä¸€å±‚å°±æ²¡æœ‰äº†
- MIR ä¼˜åŒ–
- LLVM IR  ä¼˜åŒ–
- 0/1

##### Rust è¯æ³•ç»“æ„

- åŒ…å«å…­å¤§éƒ¨åˆ†
  - å…³é”®å­— keywords
  - æ ‡è¯†ç¬¦ Identifier
  - æ³¨é‡Š Comment
  - ç©ºç™½ Whitespace
  - è¯æ¡ Tokens
  - è·¯å¾„ Path

###### å…³é”®å­—

- ä¸¥æ ¼å…³é”®å­— Strict
  - As, break, const, contunue, crate, if, else, struct, enum, true, false, fn, for, in, let, loop, impl, mod, match, move, mut, pub, ref, return, self, Self, static, super, trait, type, unsafe, use, where, while, async, await, dyn, main
- ä¿ç•™å­— Reserved 
  - Abstratct, become, box, do, final, macro, override, priv, typeof, unsized, virtual, yield, try
  - è¢«ä¿ç•™çš„å…³é”®å­—ä¸ä»£è¡¨å°†æ¥ä¸€å®šä¼šä½¿ç”¨
- å¼±å…³é”®å­— Weak
- 2018 Edition: union, 'static
  - 2015 Edition: dyn
  - è¢«ä¿ç•™çš„å…³é”®å­—ä¸ä»£è¡¨å°†æ¥ä¸€å®šä¼šä½¿ç”¨

###### æ ‡è¯†ç¬¦

```rust
let thinking = "thinking";
let thinging123_ = "thinking 123";

// error : invalid suffix 'thinking' for integer literal
// let 321_thinking = "thinking";

// ok 
let _321_thinking = "thinking";

// non-ascii ident
// RFC: https://github.com/rust-lang/rfcs/blob/master/text/2457-non-ascii-idents.md
// error: unknown start of token: \u{1f914}
let ğŸ¯ = "thinking ";
```



##### æ³¨é‡Š

```rust
pub mod outer_module {
    //! -æ¨¡å—çº§æ–‡æ¡£æ³¨é‡Šï¼Œç½®äºæ¨¡å—å¤´éƒ¨
    //!ï¼ - æ¨¡å—çº§æ–‡æ¡£æ³¨é‡Šï¼Œä½†æ˜¯å’Œä¸Šé¢æ³¨é‡Šç½®äºåŒä¸€è¡Œ

    //! - æ¨¡å—çº§æ–‡æ¡£æ³¨é‡Šï¼Œä½†ä¼šæ¢è¡Œ
    /*ï¼ - æ¨¡å—çº§æ–‡æ¡£æ³¨é‡Š */
    /*!! - æ¨¡å—çº§æ–‡æ¡£æ³¨é‡Šï¼Œä½†æ˜¯å’Œä¸Šé¢æ³¨é‡Šç½®äºåŒä¸€è¡Œ */

    /*! - æ¨¡å—çº§æ³¨é‡Šï¼Œä½†ä¼šæ¢è¡Œ */

    // - æ™®é€šè¡Œæ³¨é‡Š
    /// è¡Œçº§æ–‡æ¡£æ³¨é‡Š(å¿…é¡»æ˜¯ä¸‰ä¸ªæ–œæ ï¼‰
    ///// - æ™®é€šè¡Œæ³¨é‡Š

    /* - æ™®é€šå—çº§æ³¨é‡Š */
    /** - å—çº§æ–‡æ¡£æ³¨é‡Š2ä¸ªæ˜Ÿå· */
    /*** - æ™®é€šæ³¨é‡Š */

    pub mod inner_module {}

    /// modå®šä¹‰ä¸ªæ¨¡å—
    pub mod nested_comments {
        /* Rust ä¸­çš„æ³¨é‡Š /* å¯ä»¥ /* åµŒå…¥æ³¨é‡Š */*/*/

        // æ‰€æœ‰ä¸‰ç§æ³¨é‡Šå¯ä»¥ç›¸äº’åµŒå¥—

        /* /* */ /** */ /*! */ */
        /*! /* */ /** */ /*!*/ */
        /** /* */ /** */ /*! */ */
        pub mod dummy_item {}
    }

    pub mod degenerate_cases {
        // ç©ºçš„æ¨¡å—çº§æ–‡æ¡£æ³¨é‡Š
        //!

        // ç©ºçš„æ¨¡å—çº§æ–‡æ¡£æ³¨é‡Š
        /*! */

        // ç©ºçš„è¡Œæ³¨é‡Š
        //

        // empty outer lin doc
        /// ç©ºçš„è¡Œçº§æ–‡æ¡£æ³¨é‡Š

        // ç©ºçš„å—æ³¨é‡Š
        /**/

        pub mod dummy_item {}

        // æ³¨æ„ï¼Œæ­¤å¤„ä¸æ˜¯ç©ºçš„å—çº§æ–‡æ¡£æ³¨é‡Šï¼Œè€Œåªæ˜¯ä¸€ä¸ªæ™®é€šå—çº§æ³¨é‡Š
        /***/
    }

    /*
    ä¸‹é¢è¿™ç§æ³¨é‡Šæ˜¯ä¸å…è®¸çš„ï¼Œ å› ä¸ºæ–‡æ¡£æ³¨é‡Šä¸‹é¢å¿…é¡»è¦æœ‰è¯­è¨€é¡¹ï¼Œæ¯”å¦‚æ–¹æ³•ï¼Œå‡½æ•°ç­‰
    /// where is my item?
    */
}
```

###### ç©ºç™½

- Rust ä¸­ç©ºç™½ç¬¦åŒ…æ‹¬: \n, \t, tab ç­‰
- ä»»ä½•å½¢å¼çš„ç©ºç™½ç¬¦åœ¨Rustä¸­åªç”¨äºåˆ†éš”æ ‡è®°ï¼Œæ²¡æœ‰è¯­ä¹‰æ„ä¹‰ã€‚

###### è¯æ¡

- è¯­è¨€é¡¹ item åŸºäºçš„è¯­è¨€é¡¹
- å— Block
- è¯­å¥ Stmt
- è¡¨è¾¾å¼ Expr
- æ¨¡å¼ Pattern
- å…³é”®å­— Keyword
- æ ‡è¯†ç¬¦ ident
- å­—é¢é‡ Literal
- ç”Ÿå‘½å‘¨æœŸ Lifetime
- å¯è§æ€§ Vis
- æ ‡ç‚¹ç¬¦å· Punctuation
- åˆ†éš”ç¬¦ delimiter
- è¯æ¡æ ‘ Token Tree
- å±æ€§ Attribute

```rust
macro_rules! calculate {
  (eval $e:expr) => {{
    {
      let val : usize = $e; // force types to be integers
      println!("{} = {}", stringify!{$e}, val);
    }
  }};
}

calculate!{
  eval 1 + 2 // hehehe 'eval' is not Rust keywords
}

calculate!{
  eval (1 + 2) * (3 / 4)
}
```



###### è·¯å¾„

```rust

// æ¨¡å—è·¯å¾„
mod a {
  fn foo() {}

  mod b {
    mod c {
      fn foo() {
        super::super::foo(); // call a's foo function
        self::super::super::foo(); // call a's foo function
      }
    }
  }
}

// æ–¹æ³•è°ƒç”¨

struct  S;
impl S {
  fn f() {
    println!("S");
  }
}
trait T1 {
  fn f() {
    println!("T1 f");
  }
}

impl T1 for S {}
trait T2 {
  fn f() {
    println!("T2 f");
  }
}

impl T2 for S {}
S::f(); // calls the inherent impl
// å®Œå…¨é™å®šæ— æ­§ä¹‰è°ƒç”¨
<S as T1>::f(); // calls the T1 trait function.
<S as T2>::f(); // calls the T2 trait function.


// æ³›å‹å‡½æ•°-turbofish æ“ä½œç¬¦
(0..10).collect::<Vec<_>>();
Vec::<u8>::with_capacity(1024);

```



### é¢å‘è¡¨è¾¾å¼ï¼ˆä¸Šï¼‰

#### åŒ…å«å†…å®¹ï¼š

- è¡¨è¾¾å¼å’Œè¯­å¥
- Rustè¯­æ³•çš„â€éª¨æ¶â€œ
- Rust,é¢å‘è¡¨è¾¾å¼çš„è¯­è¨€

#### è¡¨è¾¾å¼å’Œè¯­å¥

##### å¹¿ä¹‰è§’åº¦: 

æ¯è¡Œä»£ç éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¯­å¥

##### è¯­å¥çš„å››ç§ç±»å‹

-  å£°æ˜è¯­å¥
- æµç¨‹æ§åˆ¶è¯­å¥
- è¡¨è¾¾å¼è¯­å¥
- å®è¯­å¥

#### Rustè¯­æ³•çš„åŸºæœ¬éª¨æ¶

##### å‹ç¼©ä¸ºä¸€è¡Œ

##### ç®€åŒ–

##### ç»§ç»­ç®€åŒ–

##### ä¸‰ä¸ªå…³é”®å…ƒç´ 

- å±æ€§ï¼Œç±»ä¼¼äº#![...]
- åˆ†å·ã€;ã€‘, è¡Œåˆ†éš”ç¬¦
- èŠ±æ‹¬å·ã€[...]ã€‘, å—åˆ†éš”ç¬¦

#### Rust: é¢å‘è¡¨è¾¾å¼çš„è¯­è¨€

Rustè¯­è¨€å€Ÿé‰´äº†å‡½æ•°å¼è¯­è¨€ï¼Œé¢å‘è¡¨è¾¾å¼

åˆ†å·å’Œå—ï¼Œæ˜¯Rustè¯­è¨€çš„ä¸¤ä¸ªåŸºæœ¬è¡¨è¾¾å¼

##### åˆ†å·è¡¨è¾¾å¼

å•å…ƒç±»å‹(Unit Type) 

; -> ()

##### å—è¡¨è¾¾å¼

å—ä¸­æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼

##### æ±‚å€¼è§„åˆ™

- åˆ†å·è¡¨è¾¾å¼è¿”å›å€¼æ°¸è¿œä¸ºè‡ªèº«çš„å•å…ƒUnitç±»å‹:()
- åˆ†å·è¡¨è¾¾å¼åªæœ‰åœ¨å—è¡¨è¾¾å¼æœ€åä¸€è¡Œæ‰ä¼šè¿›è¡Œæ±‚å€¼ï¼Œå…¶ä»–æ—¶å€™åªä½œä¸ºâ€è¿æ¥ç¬¦â€œå­˜åœ¨ã€‚
- å—è¡¨è¾¾å¼åªå¯¹å…¶æœ€åä¸€è¡Œè¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼

```rust
fn main() -> () {
  ;
  ;
  {
    () // -> ()
  }
  {
    ();
    use std::vec::Vec; // -> ()
  }
  ();
  &{;}; // -> &()
  ; // -> ()
  ; // -> ()
}
```

##### å¦ä¸€ç§åˆ’åˆ†æ–¹å¼

- åŸºæœ¬è¯­å¥
  - å£°æ˜è¯­å¥
  - è¡¨è¾¾å¼è¯­å¥
- è¡¨è¾¾å¼
  - å—ä¸­æœ€åä¸€è¡Œä¸åŠ åˆ†å·çš„è¡¨è¾¾å¼	
  - æµç¨‹æ§åˆ¶ä¹Ÿæ˜¯è¡¨è¾¾å¼

#### ä½œä¸š

- Rust è¯­è¯­æ³•ä¸­è¿˜æœ‰å¾ˆå¤šç§ç±»çš„è¡¨è¾¾å¼ï¼Œè¯¾å ‚é‡Œæ²¡æœ‰ä¸€ä¸€åˆ—ä¸¾ï¼Œä½ å¯ä»¥åœ¨è¯¾ä¸‹æŠŠè¿™äº›è¡¨è¾¾å¼éƒ½èµ°æŸ¥ä¸€é
- æ“ä½œç¬¦éƒ½æ˜¯è¡¨è¾¾å¼ï¼Œå®ƒä»¬éƒ½æœ‰ä¼˜å…ˆçº§ï¼Œä½ æ˜¯å¦å¯ä»¥è‡ªè¡Œäº†è§£ä¸€ä¸‹è¿™äº›æ“ä½œç¬¦è¡¨è¾¾å¼çš„ä¼˜å…ˆçº§åˆ—è¡¨å‘¢ã€‚



